<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Better Tech Now - Home</title>
  <link rel="shortcut icon" href="./laptop.ico" type="image/x-icon">
  <link rel="stylesheet" href="style.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    .product h1, .product span { color: blue; }
    .modal-overlay {
      position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7);
      display: flex; align-items: center; justify-content: center; z-index: 9999;
    }
    .userinfo-card {
      background: #fff; padding: 30px 40px; border-radius: 15px;
      box-shadow: 0 8px 16px rgba(0,0,0,0.3); max-width: 400px; width: 90%; position: relative;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; animation: fadeIn 0.3s ease;
    }
    .userinfo-card h1 { font-size: 20px; margin: 10px 0; color: #333; text-align: left; }
    .close-btn {
      position: absolute; top: 10px; right: 10px; cursor: pointer; font-size: 22px;
      background: #ff4d4d; color: white; border: none; border-radius: 50%; width: 30px; height: 30px;
      display: flex; align-items: center; justify-content: center; transition: background 0.3s;
    }
    .close-btn:hover { background: #e60000; }
    @keyframes fadeIn {
      from { opacity: 0; transform: scale(0.95); }
      to { opacity: 1; transform: scale(1); }
    }
  </style>
</head>
<body>

<header class="main-header">
  <div class="header-container">
    <div class="logo">
      <h1>üíªBetter Tech Nowüíª</h1>
    </div>
    <div class="search-bar">
      <input style="border-top-right-radius: 0; border-bottom-right-radius: 0;" id="searchInput" type="text" placeholder="Search products...">
      <button onclick="searchProducts()">üîç</button>
    </div>
    <div class="header-buttons header-div">
      <a href="cart.html" id="cart12" style="display: none;" class="header-btn">üõí Cart</a>
      <button class="header-btn login">üë§ Register</button>
      <span style="margin-top: 10px;" class="usersr"></span>
      <a href="secretlore.html" class="header-btn">üìú Secret Lore</a>
    </div>
  </div>
</header>

<br><br>

<div style="width: 50%; margin: auto; border: 4px solid #007bff; border-radius: 10px; overflow: hidden;" id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3000">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active"></button>
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1"></button>
    <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="./01EkpVu1uymPR1Az3VmweO8-2.png" class="d-block w-100" alt="...">
    </div>
    <div class="carousel-item">
      <img src="./maxresdefault (1).jpg" class="d-block w-100" alt="...">
    </div>
    <div class="carousel-item">
      <img src="./maxresdefault.jpg" class="d-block w-100" alt="...">
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
    <span class="carousel-control-prev-icon"></span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
    <span class="carousel-control-next-icon"></span>
  </button>
</div>

<section></section>

<div class="showcr">
  <h2>Products:</h2>
  <div id="product-list"></div>
</div>

<footer class="main-footer">
  <p>¬© 2025 Better Tech Now. All rights reserved.</p>
  <div class="footer-links">
    <a href="index.html">Home</a>
    <a href="products.html">Products</a>
    <a href="cart.html">Cart</a>
    <a href="secretlore.html">Secret Lore</a>
    <a href="#">Contact</a>
  </div>
</footer>

<script>
const cart = JSON.parse(localStorage.getItem('cart')) || [];
let registeredUser = JSON.parse(localStorage.getItem('registeredUser')) || null;

function toggleButtons(loggedIn) {
  document.querySelectorAll(".notshowing").forEach(btn => {
    btn.style.display = loggedIn ? "inline" : "none";
  });
}

window.onload = () => {
  if (registeredUser) {
    updateProfileUI();
    toggleButtons(true);
  } else {
    toggleButtons(false);
  }
};

async function loadProducts() {
  const response = await fetch("https://api.everrest.educata.dev/shop/products/all");
  const data = await response.json();
  displayProducts(data.products);
}

function displayProducts(products) {
  let html = "";
  products.forEach(product => {
    html += `
      <div class="product">
        <a href="products.html?id=${product._id}">
          <img src="${product.thumbnail}" alt="${product.title}">
          <h1>${product.title}</h1>
          <span>Price: ${product.price.current} ${product.price.currency}</span>
          <p>${renderStars(product.rating)}</p>
        </a>
        <button onclick='addToCart(${JSON.stringify(product).replace(/'/g, "&apos;")})'>Add To Cart</button>
      </div>
    `;
  });
  document.getElementById("product-list").innerHTML = html;
}

function renderStars(rating) {
  const fullStars = Math.floor(rating);
  const halfStar = rating % 1 >= 0.5 ? 1 : 0;
  const emptyStars = 5 - fullStars - halfStar;
  return '‚òÖ'.repeat(fullStars) + (halfStar ? '‚Ø™' : '') + '‚òÜ'.repeat(emptyStars);
}

function addToCart(product) {
  if (registeredUser) {
    cart.push(product);
    localStorage.setItem('cart', JSON.stringify(cart));
    alert('Added to cart!');
  } else {
    alert("You can't add to cart without registering.");
  }
}

function searchProducts() {
  const query = document.getElementById('searchInput').value.toLowerCase();
  fetch("https://api.everrest.educata.dev/shop/products/all")
    .then(res => res.json())
    .then(data => {
      const filtered = data.products.filter(p => p.title.toLowerCase().includes(query));
      displayProducts(filtered);
    });
}

loadProducts();
document.querySelector(".login").addEventListener("click", loginpopup);

function loginpopup() {
  if (registeredUser) {
    showProfilePopup();
    return;
  }
  const form = `
    <div class="modal-overlay"></div>
    <div class="logincard">
      <div class="userinfo-card">
        <div class="close-btn" onclick="closeModal()">‚úï</div>
        <input id="phone" placeholder="Phone Number">
        <input id="pass" type="password" placeholder="Password">
        <input id="mail" type="email" placeholder="Email">
        <input id="fname" placeholder="First Name">
        <input id="lname" placeholder="Last Name">
        <input id="role" placeholder="Role">
        <p class="errormessage"></p>
        <button onclick="submitLogin()">Submit</button>
      </div>
    </div>
    `;
  document.querySelector("section").innerHTML = form;
}

function closeModal() {
  document.querySelector("section").innerHTML = "";
}

async function submitLogin() {
  const phoneNumber = document.getElementById("phone").value.trim();
  const password = document.getElementById("pass").value.trim();
  const email = document.getElementById("mail").value.trim();
  const firstName = document.getElementById("fname").value.trim();
  const lastName = document.getElementById("lname").value.trim();
  const role = document.getElementById("role").value.trim();

  if (!phoneNumber || !password || !email || !firstName || !lastName || !role) {
    document.querySelector(".errormessage").textContent = "Please fill all fields.";
    return;
  }

  const data = { phoneNumber, password, email, firstName, lastName, role };
  try {
    const response = await fetch("https://rentcar.stepprojects.ge/api/Users/register", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(data)
    });
    const json = await response.json();
    if (!response.ok) {
      document.querySelector(".errormessage").textContent = json.message || "Registration failed.";
      return;
    }
    alert("Registration successful!");
    registeredUser = data;
    localStorage.setItem('registeredUser', JSON.stringify(registeredUser));
    updateProfileUI();
    toggleButtons(true);
    closeModal();
  } catch {
    document.querySelector(".errormessage").textContent = "Registration failed.";
  }
}

function updateProfileUI() {
  if (registeredUser) {
    document.querySelector("#cart12").style.display = "inline"
    document.querySelector(".usersr").textContent = `Welcome: ${registeredUser.firstName}`;
    const loginButton = document.querySelector(".login");
    loginButton.textContent = "My Profile";
    loginButton.onclick = showProfilePopup;
    if (!document.querySelector(".logout")) {
      const logoutBtn = document.createElement("button");
      logoutBtn.textContent = "Log Out";
      logoutBtn.classList.add("logout");
      logoutBtn.style.marginLeft = "10px";
      logoutBtn.onclick = logout;
      document.querySelector(".header-div").appendChild(logoutBtn);
    }
  }
}

function logout() {
  if (confirm("Are you sure?")) {
    registeredUser = null;
    localStorage.removeItem('registeredUser');
    document.querySelector(".usersr").textContent = "";
    const loginButton = document.querySelector(".login");
    loginButton.textContent = "üë§ Register";
    loginButton.onclick = loginpopup;
    const logoutBtn = document.querySelector(".logout");
    if (logoutBtn) logoutBtn.remove();
    toggleButtons(false);
    closeModal();
  }
}

function showProfilePopup() {
  if (registeredUser) {
    const profile = `
      <div class="modal-overlay">
        <div class="userinfo-card">
          <button class="close-btn" onclick="closeModal()">‚úï</button>
          <h1>üì± Phone: ${registeredUser.phoneNumber}</h1>
          <h1>üîë Password: ${registeredUser.password}</h1>
          <h1>üìß Email: ${registeredUser.email}</h1>
          <h1>üë§ First Name: ${registeredUser.firstName}</h1>
          <h1>üë• Last Name: ${registeredUser.lastName}</h1>
          <h1>üè∑Ô∏è Role: ${registeredUser.role}</h1>
        </div>
      </div>`;
    document.querySelector("section").innerHTML = profile;
  }
}
</script>

</body>
</html>
